# bedhedd's nix config
Welcome to this repo. If you would like to follow the development of this config, I posted updates here [bedHedd’s NixOS Adventure](https://forum.level1techs.com/t/bedhedds-nixos-adventure/228975).

If you are already experienced with nix, you can run within the root of the cloned repository. 
```bash
nixos-rebuild switch --flake .
```

# structure of this repo
```bash
./nix-config
├── dotfiles
│   └── fish-config.nix
├── flake.lock
├── flake.nix
├── LICENSE
├── machines
│   └── jade-tiger
│       ├── configuration.nix
│       ├── hardware-configuration.nix
│       ├── home.nix
│       └── users.nix
├── modules
│   ├── entertainment.nix
│   ├── home.nix
│   ├── kde-home.nix
│   ├── kde.nix
│   └── steamdeck-plasma-system.nix
├── README.md
└── users
    ├── admin.nix
    ├── bedhedd.nix
    └── dev.nix
```
## background / philosophy
The goal of this is to have a minimal modular `configuration.nix` file for each machine. As I add machines, I will copy the ` configuration.nix` and `hardware.nix` file generated by the installer to the machine specific folder.

I based this off of [michaelpj](https://github.com/michaelpj) nix repo structure
https://github.com/michaelpj/nixos-config/tree/master

I have configured this such that `configuration.nix` will import `kde.nix` and the `steamdeck-plasma-system.nix` files from modules, followed by the users and home-manager. In the future, I plan to automate this process, but for now it is manual.

`home.nix` imports packages I wish to share across all machines. `kde-home.nix` contains my kde specific customizations 


## understanding the folders
- `dotfiles`: contains cli specific customizations. E.g fish shell customizations
- `machines`: contains all specific customizations for a given hardware configuration
- `modules`: contains all customizations for packages I use, shared across all machines
- `users`: contains all user file customizations, allows me to pull user configs for machines


# getting started from scratch
## background
This guide assumes that your hardware is similar to mine and you wish to build a config similar to one of my machines. Note that you may need to modify it for your use case, this guide is for myself to remember when I need to come back and setup nix again.

## install nix
If you have been linked this repo and have not yet installed NixOS, please start by installing nix. Follow the guide from the [wiki](https://wiki.nixos.org/wiki/NixOS_Installation_Guide). Make sure to enable kde, flakes, and unfree software if you are using the graphical installer

## download/clone this repo
Start by cloning this repo using git. Ensure that you have it installed and you have a internet connection 
```bash
git clone https://github.com/BedHedd/nix-config.git
```

If git is not installed in the terminal, download the repo as a zip. 
1. Navigate and click the green `< > Code` button 
2. Navigate and click the `Download ZIP` button

## applying my config
After downloading this repo, navigate to the directory using your terminal or a preferred file explorer/text editor. If you run tree, this is the folder structure
```bash
./nix-config
├── dotfiles
│   └── fish-config.nix
├── flake.lock
├── flake.nix
├── LICENSE
├── machines
│   └── jade-tiger
│       ├── configuration.nix
│       ├── hardware-configuration.nix
│       ├── home.nix
│       └── users.nix
├── modules
│   ├── entertainment.nix
│   ├── home.nix
│   ├── kde-home.nix
│   ├── kde.nix
│   └── steamdeck-plasma-system.nix
├── README.md
└── users
    ├── admin.nix
    ├── bedhedd.nix
    └── dev.nix
```
### create a user
Within the root of the repo, navigate to the `users` folder and create a new file for a user. Feel free to reuse any of the existing user files. `bedhedd.nix` and `dev.nix` are almost identical. `admin` has a minimal configuration. Make sure to rename the username from `bedhedd` or `dev` or `admin` as that is your account name
```nix
let
  username     = "bedhedd";
```  

### add a machine
#### adding a custom configuration/hardware-configuration 
After creating a user, navigate to the `machines` folder and copy any machine specific folder. Review the respective `configuration.nix` and `hardware-configuration.nix` to see if your machine will be similar. 

If your machine is not the same, copy the `configuration.nix` and `hardware-configuration.nix` generated by NixOS. It is found within `/etc/nixos`.

Make sure to create a symlink to the `configuration.nix` and `hardware-configuration.nix` within `/etc/nixos`. Follow the instructions in a reply to this post [Using git to handle and manage `configuration.nix`](https://discourse.nixos.org/t/using-git-to-handle-and-manage-configuration-nix/38337/4)

#### importing my configurations to `configuration.nix`
Add the following imports to `configuration.nix`
```nix
  imports =
    [
      ../../modules/kde.nix
      ../../modules/steamdeck-plasma-system.nix
      ./hardware-configuration.nix
      home-manager.nixosModules.home-manager
      ./users.nix
    ];
```    

Afterwards set your `hostName` to the name you wish for your machine to show up as on the network. For example, if you are modifying the `machines/jade-tiger` config, replace `jade-tiger` in `networking.hostName`
```
  networking.hostName = "jade-tiger"; # Define your hostname.
```

If you didn't already add the experimental flakes feature, make sure to add the following line anywhere within `configuration.nix`
```
nix.settings.experimental-features = [ "nix-command" "flakes"];
```

The last thing to add is home manager and plasma manager, copy and paste the following snippet 
```
  home-manager.useGlobalPkgs   = true;
  home-manager.useUserPackages = true;

  home-manager.sharedModules = [
    plasma-manager.homeManagerModules."plasma-manager"
  ];
```  
#### adding users to the machine
With your configuration set, you will now need to modify the `users.nix` file within your machine specific folder. All `users.nix` does is import the files to the `configuration.nix` file. Make sure to add a new entry if you created your own user.

### update the flake
With your machine initialized, you'll now need to update `flake.nix` to include your machine. If you do not want to modify my entry, you can just update replace `jade-tiger` with your machine name.

```nix
{
    nixosConfigurations.jade-tiger = nixpkgs.lib.nixosSystem {
      system = "x86_64-linux";

      modules = [
        (import ./machines/jade-tiger/configuration.nix)
        revModule
        localNixpkgsModule

        # ← pull in Home‑Manager as a NixOS module:
        home-manager.nixosModules.home-manager
      ];

      # expose both home-manager and plasma-manager into your
      # machine’s specialArgs so that configuration.nix can see them:
      specialArgs = { inherit nixos-hardware home-manager plasma-manager; };
    };
  };
```  
Otherwise copy the entry above and replace it with your machine name  

### building my config
With everything configured you will want to navigate to the root of the zip/repo. Run the following command if you replaced the `jade-tiger` block
```
nixos-rebuild switch --flake .
```

otherwise, you'll want to run this command
```
nixos-rebuild switch --flake .#jade-tiger
```
replace `jade-tiger` with the name of the machine you configured in the previous step
